language: java
jdk: openjdk7
before_script:
  - mkdir -p shippable/codecoverage
  # Using cover2cover to translate Jacoco output to Cobertura format for Shippable's sake
  - curl -sO https://raw.githubusercontent.com/rix0rrr/cover2cover/master/cover2cover.py && chmod +x cover2cover.py
after_script:
  - mv build/test-results shippable/testresults
  - python cover2cover.py build/reports/jacoco/test/jacocoTestReport.xml src/main/java > shippable/codecoverage/coverage.xml
after_success:
  - echo "Script is successful"
  
build:
  pre_ci:
    - echo "PRE-CLI"
    - echo $SHIPPABLE_BUILD_DIR
  pre_ci_boot:
      image_name: atulpundhir/spring-web
      image_tag: latest
      pull: true
      env: FOO=bar
    - options: "-v /app:/app"
  ci:
    - mvn package
  post_ci:
    - docker build -t atulpundhir/spring-web:$BRANCH.$BUILD_NUMBER .
    - docker push atulpundhir/spring-web:$BRANCH.$BUILD_NUMBER
    - echo "POST CI"
  on_success:
    - echo " Success"
  on_failure:
    - echo " Failed"
    
integrations:                               
  hub:
    - integrationName:  Shippable_Docker_Test    #replace with your subscription integration name   
      type: dockerRegistryLogin                        

